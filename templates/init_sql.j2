CREATE DATABASE {{ DB_DATABASE }} WITH OWNER {{ DB_USER }};

CREATE USER {{ DB_USER }} WITH PASSWORD '{{ DB_PASSWORD }}';

\c {{ DB_DATABASE }};

CREATE TABLE emails(
   id SERIAL PRIMARY KEY,
   email VARCHAR(255) NOT NULL,
   insert_time TIMESTAMP NULL
);


CREATE TABLE phone_numbers(
   id SERIAL PRIMARY KEY,
   phone VARCHAR(255) NOT NULL,
   insert_time TIMESTAMP NULL
);

CREATE USER {{ DB_REPL_USER }}  WITH REPLICATION ENCRYPTED PASSWORD '{{ DB_REPL_PASSWORD }}';

SELECT pg_create_physical_replication_slot('replication_slot');

GRANT SELECT, INSERT, UPDATE, TRIGGER ON  emails TO {{  DB_USER }};
GRANT SELECT, INSERT, UPDATE, TRIGGER ON  phone_numbers TO {{ DB_USER }} ;
GRANT ALL ON SEQUENCE emails_id_seq to {{ DB_USER }};
GRANT ALL ON SEQUENCE phone_numbers_id_seq to {{ DB_USER }};
